-- int8 check


-- SELECT pg_sleep(20);

SELECT int64_to_bitstring(0);
SELECT int64_to_bitstring(1);
SELECT int64_to_bitstring(2);
SELECT int64_to_bitstring(-1);
SELECT int64_to_bitstring(-2);
SELECT int64_to_bitstring(9223372036854775807);

SELECT bitstring_to_int64('0000000000000000000000000000000000000000000000000000000000000000');
SELECT bitstring_to_int64('0000000000000000000000000000000000000000000000000000000000000001');
SELECT bitstring_to_int64('0111111111111111111111111111111111111111111111111111111111111111');
SELECT bitstring_to_int64('1111111111111111111111111111111111111111111111111111111111111111');
SELECT bitstring_to_int64('1111111111111111111111111111111111111111111111111111111111111110');

-- Check function round-tripping

-- Annoying casting is because I haven't figured out how to return an instance of "text" from a c function
-- Mostly because it works as is, and it's not critical.
SELECT int64_to_bitstring(bitstring_to_int64('0000000000000000000000000000000000000000000000000000000000000000'))::text
	= '0000000000000000000000000000000000000000000000000000000000000000'::text;
SELECT int64_to_bitstring(bitstring_to_int64('0000000000000000000000000000000000000000000000000000000000000001'))::text
	= '0000000000000000000000000000000000000000000000000000000000000001'::text;
SELECT int64_to_bitstring(bitstring_to_int64('0111111111111111111111111111111111111111111111111111111111111111'))::text
	= '0111111111111111111111111111111111111111111111111111111111111111'::text;
SELECT int64_to_bitstring(bitstring_to_int64('1111111111111111111111111111111111111111111111111111111111111111'))::text
	= '1111111111111111111111111111111111111111111111111111111111111111'::text;
SELECT int64_to_bitstring(bitstring_to_int64('1111111111111111111111111111111111111111111111111111111111111110'))::text
	= '1111111111111111111111111111111111111111111111111111111111111110'::text;


SELECT bitstring_to_int64(int64_to_bitstring(0)) = 0;
SELECT bitstring_to_int64(int64_to_bitstring(1)) = 1;
SELECT bitstring_to_int64(int64_to_bitstring(2)) = 2;
SELECT bitstring_to_int64(int64_to_bitstring(-1)) = -1;
SELECT bitstring_to_int64(int64_to_bitstring(-2)) = -2;
SELECT bitstring_to_int64(int64_to_bitstring(9223372036854775807)) = 9223372036854775807;

-- We expect these to fail
SELECT bitstring_to_int64('01111111111111111111111111111111111111111111111111111111111111110');

SELECT bitstring_to_int64('111111111111111111111111111111111111111111111111111111111111110');

SELECT bitstring_to_int64('11111111111111111111xx111111111111111111111111111111111111111110');

SELECT bitstring_to_int64('wat');


-- Validate the hamming distance operator
-- A lot of this is trying to break anything that depends on the
-- sign bit when it shouldn't. Some of it is just silly, some of
-- it tries to validate the minimum and maximum distances.

SELECT
		bitstring_to_int64('0000000000000000000000000000000000000000000000000000000000000000')
	<->
		bitstring_to_int64('0000000000000000000000000000000000000000000000000000000000000000')
;

SELECT
		bitstring_to_int64('0000000000000000000000000000000000000000000000000000000000000000')
	<->
		bitstring_to_int64('0000000000000000000000000000000000000000000000000000000000000001')
;

SELECT
		bitstring_to_int64('0000000000000000000000000000000000000000000000000000000000000000')
	<->
		bitstring_to_int64('1000000000000000000000000000000000000000000000000000000000000000')
;

SELECT
		bitstring_to_int64('1000000000000000000000000000000000000000000000000000000000000000')
	<->
		bitstring_to_int64('1000000000000000000000000000000000000000000000000000000000000000')
;

SELECT
		bitstring_to_int64('0000000000000000000000000000000000000000000000000000000000000000')
	<->
		bitstring_to_int64('1000000000000000000000000000000000000000000000000000000000000001')
;

SELECT
		bitstring_to_int64('0000000000000000000000000000000000000000000000000000000000000000')
	<->
		bitstring_to_int64('0000000000000000000000000000000000000000000000000000000000000011')
;

SELECT
		bitstring_to_int64('0000000000000000000000000000000000000000000000000000000000000000')
	<->
		bitstring_to_int64('0111111111111111111111111111111111111111111111111111111111111111')
;

SELECT
		bitstring_to_int64('0000000000000000000000000000000000000000000000000000000000000000')
	<->
		bitstring_to_int64('1111111111111111111111111111111111111111111111111111111111111111')
;

SELECT
		bitstring_to_int64('1111111111111111111111111111111111111111111111111111111111111110')
	<->
		bitstring_to_int64('1111111111111111111111111111111111111111111111111111111111111111')
;

SELECT
		bitstring_to_int64('0111111111111111111111111111111111111111111111111111111111111111')
	<->
		bitstring_to_int64('1111111111111111111111111111111111111111111111111111111111111111')
;

SELECT
		bitstring_to_int64('0111111111111111111111111111111111111111111111111111111111111110')
	<->
		bitstring_to_int64('1111111111111111111111111111111111111111111111111111111111111111')
;
